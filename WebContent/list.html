<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>전체</title>
<script src="http://code.jquery.com/jquery.js"></script>
<script src="https://cdn.jsdelivr.net/npm/underscore@1.12.0/underscore-min.js"></script>
<script>
var listTemp = 
	`<table>
		<tr>
		<th>음식명</th>
		<th>음식점</th>
		<th>종류</th>
		<th>가격</th>
		<th>별점</th>
		<th>날짜</th>
		</tr>
		<%
		for(var i=0; i<food_list.length; i++) { 
			var food = food_list[i];
		%>
		<tr>
			<td><a href=""><%=food.fname %></td>
			<td><%=food.store %></td>
			<td><%=food.type %></td>
			<td><%=food.price %></td>
			<td><%=food.star %></td>
			<td><%=food.date %></td>
		</tr>
		<%
		}
		%>
	</table>`;
// 여기까지 리스트 템플릿

$(function(){
	var fList = [];
	
	function getList(cmd, searchData){
		$.get("FoodLogServer.jsp?cmd="+cmd+"&searchData="+searchData, function(data,status){
			console.log(data); // 정보 안넘어옴.. 비어있음 ㅠ
			console.log(status)
			if(status == 'success'){
				var jsObj = JSON.parse(data.trim());
				fList = jsObj.food_list;
				
				var compiled = _.template(listTemp);
				$('#foodlistarea').html( compiled({food_list: fList}) );
			} else {
				document.write("<h1>오륜디...</h1>");
			}
		});
	} // getList 함수 끝
	
	getList("list",null);
	

	var funcSearch = function(){
		var newFoodList = [];
		var searchData = $('#searchData').val();
		var searchType = $('#searchType').val();
		
		var patt = new RegExp(searchData, "gi"); // 대소문자 구분X
		for(food of fList) {
			if(food[searchType].match(patt)) {
				newFoodList.push(food);
			}
		}
		
		var compiled = _.template(listTemp);
		$('#foodlistarea').html( compiled({food_list: newFoodList}) );
	}
	$('#searchBtn').click(funcSearch);
	
});
</script>

<style>
header, footer, section, table, div#foodlistarea {	/* 위치 확인 및 전체크기 맞추기용 */
		border: 1px solid blue;
		margin: 0px;
		border-radius: 0px;
		padding: 0px;
		box-sizing: border-box;
		width: 900px;
}


td, th {
	border: 1px solid blue;  /* 나중에 보더 지우기 */
	box-sizing: border-box;
	width: 150px;
}
header {
	text-align: center;
}

.searchType {
	text-align-last:center; 
	font-size:15px;
}

select {
	margin:0 0 0 30px;
	width: 150px;
}

table {
	margin:0 0 30px 0;
}

tr.contents {
	text-align: center;
}

td.left {
	width: 200px;
}

td.center {
	width: 400px;
}

td.right {
	width: 300px;
}

div.right{	/* 버튼 우측 정렬 */
	text-align: right;
}

input.searchData {	/* 텍스트 필드 넓게 */
	width: 400px
}
fotter {
		clear:both;
}
.btnstyle {
	 width:70px; 
	 height:30px; 
	 font-size:15px; 
	 border-radius:15px;
	 vertical-align:center;
	 margin:0 5px 0 0;
}
</style>

</head>
<body>

<header>
	<h2>Food Log</h2>
</header>	

<section>
	<table>
	<tr>
		<td class="left">
			<div class="left">
					<select id="searchType" class="searchType">
						<option value="korea" selected>음식명</option>
						<option value="chinese">음식점</option>
						<option value="japanese">종류</option>
						<option value="western">가격</option>
						<option value="flour">별점</option>
						<option value="drink">날짜</option>
					</select>
			</div>
		</td>
		<td class="center">	
				<input type="text" id="searchData" class="searchData">
		</td>
		<td class="rignt">
			<div class="right">
					<button type="button" class="btnstyle" id="searchBtn">검색</button>
					<button type="button" class="btnstyle" id="list">전체보기</button>
			</div>
		</td>
	</tr>
	</table>
	
	<div id="foodlistarea">
		<!-- 전체 리스트 나올 공간 -->
	</div>
</section>

</body>
</html>